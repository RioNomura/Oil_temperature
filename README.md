# Oil_temperature

【実行方法】
1.SARIMAX.py, check.py, train1.py, ett.csvを同じファイル内にディレクトリに配置します。


2.check.pyを実行することで基本統計量と、"月別平均油温グラフ.png"と"油温の時系列グラフ.png"の結果が得られます。
3.train1.pyを実行することで"特徴量上位5.png"の結果が得られます。
4.SARIMAX.pyを実行することで"SARIMAX.png"のSARIMAX部の結果が得られます。(ただし、約15分前後の実行時間がかかる)

※train1.pyの29,30行目の
df[f'{col}_lag6'] = df[col].shift(6)　
df[f'{col}_lag12'] = df[col].shift(12)

と、47~61行目
#Random Forestを使用して特徴量の重要度を計算
rf_model = RandomForestRegressor(n_estimators=100, random_state=42)
rf_model.fit(X_selected, y)

#特徴量の重要度を取得
importances = rf_model.feature_importances_
feature_importances = pd.DataFrame({'feature': X_selected.columns, 'importance': importances})
feature_importances = feature_importances.sort_values('importance', ascending=False)

#上位n個の特徴量を選択
n = 5  # 選択したい特徴量の数
top_features = feature_importances['feature'][:n].tolist()

#選択された特徴量のみを使用
X_selected = X_selected[top_features]

また、152~154行目の
#選択された特徴量を表示
print("特徴量一覧:")
print(top_features)

を削除することで"全特徴量.png"の結果が得られます。

ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

【プログラム概要】
# check.py
このプログラムは、油温（OT）に関する時系列データの基本的な解析を行うことを目的としています。具体的には、以下の手順でデータを分析しています。

【データの読み込みと前処理】
データは指定されたCSVファイルから読み込まれ、日付をインデックスとして設定しています。
【基本統計量の確認】
データの基本的な統計情報（平均、標準偏差、最小値、最大値など）を表示することで、データの全体像を把握します。
【時系列のトレンドと季節性の確認】
時系列データとしての油温の推移を可視化し、全体的なトレンドや季節性のパターンを確認します。
月別の平均油温をプロットすることで、季節性の傾向をさらに詳しく分析します。
【異常値の検出】
標準偏差を基にしたZスコアを計算し、異常値（平均から3標準偏差以上離れたデータポイント）を特定します。

このプログラムにより、油温データの全体的な傾向を視覚的に把握でき、特定の異常値についても識別することが可能です。

# train1.py
このプログラムは、油温（OT）の時系列データを基に、複数の機械学習モデルを使用して予測を行い、モデルの性能を比較するために設計されています。プログラムは以下のステップで構成されています。

【データの読み込みと前処理】
CSVファイルからデータを読み込み、日時をインデックスとして設定します。欠損値は前の値で埋められます。
特徴量エンジニアリングとして、時間、日、月、年、曜日の情報を追加します。
また、油温や他の変数に対して、1時間、6時間、12時間、24時間のラグ特徴量を追加し、時系列の遅延情報を取り入れます。
【データのスケーリング】
StandardScalerを使用して、全ての特徴量を標準化します。これにより、モデルが異なるスケールのデータを扱う際の問題を軽減します。
【特徴量選択】
SelectKBestを使用して、最も予測性能が高い30個の特徴量を選択します。その後、Random Forestを使用してさらに重要な特徴量を絞り込み、上位5つの特徴量を最終的に選択します。
【モデルのトレーニングと評価】
線形回帰、ランダムフォレスト、勾配ブースティング、XGBoost、LightGBMの5つのモデルを使用して、油温を予測します。
各モデルは時系列交差検証を通じてトレーニングされ、R-squared, MSE, RMSE, MAEなどの評価指標を基に性能が評価されます。
また、ARIMAモデルを用いても同様に評価を行い、各モデルの性能を比較します。
【結果の可視化】
トレーニングデータおよびテストデータにおける各モデルの評価結果をテーブル形式で表示し、視覚的に比較できるようにします。
【特徴量の重要度の確認】
選択された特徴量の一覧を表示します。また、ツリーベースのモデル（Random Forest, Gradient Boosting, XGBoost, LightGBM）については、各特徴量の重要度を表示します。

このプログラムにより、複数の機械学習モデルを比較し、最も優れたモデルを選択するための情報を提供します。

# SARIMAX.py
※実行時にかなり時間がかかるため、SARIMAXモデルのみ別のファイルで作成しています。
このプログラムは、SARIMAXモデルを使用して油温（OT）の時系列予測を行い、モデルの性能を評価するために設計されています。プログラムは以下のステップで構成されています。

【データの読み込みと前処理】
CSVファイルからデータを読み込み、日時をインデックスとして設定します。欠損値は前の値で埋められます。
特徴量エンジニアリングとして、時間、日、月、年、曜日の情報を追加します。また、油温や他の変数に対して、1時間、12時間、24時間のラグ特徴量を追加し、時系列の遅延情報を取り入れます。
【データのスケーリング】
StandardScalerを使用して、全ての特徴量を標準化します。これにより、モデルが異なるスケールのデータを扱う際の問題を軽減します。
【SARIMAXモデルの設定】
SARIMAXモデルは、過去の油温データと外部の説明変数を使用して未来の油温を予測します。モデルのオーダーは(1, 0, 1)、季節性のオーダーは(1, 1, 0, 12)として設定されています。
【モデルのトレーニングと予測】
時系列分割（TimeSeriesSplit）を使用して、データをトレーニングセットとテストセットに分割します。
各分割において、SARIMAXモデルをトレーニングし、トレーニングデータおよびテストデータに対して予測を行います。
【モデルの評価】
トレーニングおよびテストデータに対して、R-squared, MSE, RMSE, MAEなどの評価指標を計算し、モデルの性能を評価します。
評価結果は表形式で表示され、トレーニングデータとテストデータの両方についてのスコアが確認できます。
【結果の可視化】
トレーニングおよびテストの評価結果を可視化し、表形式で出力します。これにより、モデルの性能を直感的に理解することができます。



